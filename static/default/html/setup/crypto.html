{% extends "layouts/auth.html" %}
{% block title %}{{_("Passphrase")}} | {{_('Setup')}}{% endblock %}
{% block content %}

<div class="setup-box setup-box-medium animated add-bottom bounceInUp">
  <div id="identity-vault-lock" class="vault-lock-outer">
    <div class="vault-lock-inner">
      <div class="vault-lock icon-lock-closed animated"></div>
    </div>
  </div>
  <form method="POST" action="/setup/crypto/" id="form-setup-passphrase" class="standard text-center">

    {% set setup_crypto = mailpile("setup/crypto") %}
    {% if setup_crypto.result.secret_keys|length == 0 %}
    <h3 class="add-top text-center">Create Your Passphrase</h3>
    <div id="setup-passphrase-new-keys">

      <p class="text-center">
        Your passphrase should be something really hard to guess but memorable<br>
        This passphrase will be used to unlock your Mailpile and for your encryption keys
      </p>

      <span id="error-setup-passphrase" class="validation-error validation-message"></span>
      <input id="input-setup-passphrase" class="input-medium center" type="password" name="passphrase" autocorrect="off" autocapitalize="off" class="center" placeholder="top secret super duper passphrase">

      <label>Confirm Your Passphrase</label>
      <span id="error-setup-passphrase_confirm" class="validation-error validation-message"></span>
      <input id="input-setup-passphrase_confirm" class="input-medium center" type="password" name="passphrase_confirm" autocorrect="off" autocapitalize="off" class="center" placeholder="top secret super duper passphrase">

      <input name="choose_key" value="!CREATE" type="hidden">

    </div>

    {% elif setup_crypto.result.secret_keys|length >= 1 %}

    <h3 class="add-top text-center">Your Security Passphrase</h3>
    <div id="setup-passphrase-has-keys">
      <p>Select one of the <strong>{{setup_crypto.result.secret_keys|length}} Private Encryption Keys</strong> and enter the keys passphrase:</p>
      <ul class="radio-list-items">
      {% for key in setup_crypto.result.secret_keys %}
        {% set key_info = setup_crypto.result.secret_keys[key] %}
        {% if key_info.capabilities_map.0.encrypt and key_info.capabilities_map.0.sign and not key_info.disabled %}
        <li class="text-left">
        <label class="radio-list-item">
          <input name="choose_key" value="{{ key }}" type="radio" {% if key == setup_crypto.result.chosen_key %}checked{% endif %}>
          <strong>{{ key_info.keytype_name }} key {{ key }}</strong>, {{ key_info.keysize }} bits<br>
         
          <span class="text-detail">
            created on {{ key_info.creation_date }}  {% if key_info.expiration_date %}expires {{ key_info.expiration_date }}{% endif %}
          </span>
        </label>
        </li>
        {% endif %}
      {% endfor %}
      </ul>

      <span id="error-setup-passphrase" class="validation-error validation-message"></span>
      <input id="input-setup-passphrase" class="input-medium center" type="password" name="passphrase" autocorrect="off" autocapitalize="off" class="center" placeholder="top secret super duper passphrase">

      <span id="error-setup-passphrase_confirm" class="hide"></span>
      <input id="input-setup-passphrase_confirm" class="input-medium center" type="hidden" name="passphrase_confirm" autocorrect="off" autocapitalize="off" class="center" placeholder="top secret super duper passphrase">

    </div>

    {% endif %}

    <button id="btn-setup-passphrase" type="submit" class="text-center button-primary">{{_("Next")}}</button>

  </form>
</div>
{% endblock %}

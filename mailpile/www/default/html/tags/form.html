<div id="tags-settings" class="content-normal" style="position: relative">
  <div class="clearfix half-bottom">
    <h1 class="contact-name half-bottom">
      <span id="tag-editor-icon" class="{{tag.icon}}"
            style="color: {{ theme_settings().colors[tag.label_color] }}"></span>
      {{form_title}}
    </h1>
  </div>

  <p>
    <b>WIP:</b> This is probably broken! :-)
  </p>

  <p class="message paragraph-important tag-edit-title">
    <span class="icon-settings"></span> {{_("Tag Settings")}}</h4>
  </p>
  <form id="form-tag-add" class="standard" method="POST">
    <input type="hidden" name="csrf" value="">
    <input type="hidden" id="data-tag-tid" name="icon" value="{{tag.tid}}" placeholder="{{tag.tid}}">

    <div class="left">
      <div class="right">
        <a class="{{ tag.icon }} ss-choose-icon" title='{{_("Change Icon")}}'
           style="color: {{ theme_settings().colors[tag.label_color] }}"></a>
        <input type="hidden" class="ss-tag-icon" name="tag-icon" value="{{ tag.icon }}">
        <a class="ss-choose-color" title='{{_("Change Color")}}'>{{_("Color")}}</a>
        <input type="hidden" class="ss-tag-color" name="tag-color" value="{{tag.label_color}}">
      </div>
      <label>{{_("Tag")}}</label>
      <input type="text" name="name"
             value="{{tag.name}}" placeholder="{{_("Friends & Family")}}">
    </div>
    <div class="right">
      <ul>
        <li><input type="radio" name="display" value="priority" {% if tag.display == 'priority' %}checked{% endif %}>
            <span class="checkbox">{{_("Show in top of sidebar")}}</span></li>
        <li><input type="radio" name="display" value="tag" {% if tag.display == 'tag' %}checked{% endif %}>
            <span class="checkbox">{{_("Show in sidebar")}}</span></li>
        <li><input type="radio" name="display" {% if tag.display in ('archive', 'invisible') %}value="{{tag.display}}" checked{% else %}value="archive"{% endif %}>
            <span class="checkbox">{{_("Hide from sidebar")}}</span></li>
        <li><input type="checkbox" name="label" value="true" {% if tag.label %}checked{% endif %}>
            <span class="checkbox">{{_("Show in search results")}}</span></li>
      </ul>
{%- if tag.type in ('tag', 'attribute', 'spam') %}
      <ul>
        <li title="
{{- _("Enable to tag messages automatically, like spam.")}}
{{  _("Tag or un-tag mail by hand to train the system.")}}">
            <input type="checkbox" name="autotag"
                   value="true" {% if tag.autotag %}checked{% endif %}>
            <span class="checkbox">{{_("Magic tagging")}}</span>
            (<a href="">help</a>)
        </li>
      </ul>
{%- endif %}
    </div>
    <br clear="left">

    <p class="hide">
      <a>{{_("Technical settings...")}}</a>
    </p>
    <div id="form-tag-advanced" class="content-medium">

{%- if tag.type in ('tag', 'attribute') %}
      <div>
        <label>{{_("Keyword")}}</label>
        <input type="text" xid="data-tag-add-slug" name="slug" value="{{tag.slug}}">
      </div>

  {%- if not tag.subtags %}
      <div>
        <label>{{_("Parent")}}</label>
        <select name="parent" id="data-tag-parent">
          <option value="">{{_("none")}}</option>
    {%- for ptag in mailpile("tags", "mode=tree").result.tags %}
      {%- if ptag.display == "priority" or ptag.display == "tag" %}
          <option value="{{ptag.tid}}"{% if ptag.tid == tag.parent %} selected="selected"{% endif %}>{{ ptag.name }}</option>
      {%- endif %}    
    {%- endfor %}
        </select>
      </div>
  {%- endif %}
{%- endif %}

{%- if tag.subtags %}
      <h3 class="add-top">{{_("Subtags")}}</h3>
      <ul class="items grouped">
  {%- for sub in tag.subtags %}
        <li class="grouped">
          <span class="{{sub.icon}}" style="color: {{theme_settings().colors[sub.label_color]}}"></span> {{sub.name}} <a href="{{ config.sys.http_path }}/tags/edit.html?only={{sub.slug}}" class="right"><span class="icon-settings"></span> {{_("Settings")}}</a>
        </li>
  {%- endfor %}
      </ul>
{%- endif %}
    </div>
  </form>

{################ FIXME - THIS IS THE FUN STUFF!  #####################

{%- if tag.type in ('mailbox', 'tag') %}
  <p class="message paragraph-important tag-edit-title">
    <span class="icon-mailsource"></span> {{_("Mailbox Settings")}}</h4>
  </p>
  <div class="tag-edit-mailbox hide">
  </div>

  <p class="message paragraph-important tag-edit-title">
    <span class="icon-star"></span> {{_("Filters and Saved Searches")}}</h4>
  </p>
  <div class="tag-edit-filters hide">
  </div>
{%- endif %}
######################################################################}

  <div>
    <hr style="margin-bottom: 10px;">
{%- if state.command_url == "/tags/add/" %}
    <button class="button-primary right" type="submit"><span class="icon-plus"></span> {{_("Add")}}</button>
{%- else %}
    <button class="button-primary right" type="submit"><span class="icon-checked"></span> {{_("Save")}}</button>
{%- endif %}
{%- if state.command_url == "/tags/" and tag.type in ('tag', 'attribute') %}
    <button type="submit" id="button-tag-delete" class="button-warning"><span class="icon-minus"></span> {{_("Delete Tag")}}</button>
{%- endif %}
  </div>

</form>
</div>

<script id="modal-tag-icon-picker" type="text/template">
<div id="tag-edit-icon-picker" class="modal-dialog">
   <div class="modal-content">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h4 class="modal-title">{{_("Pick Tag Icon")}}</h4>
    </div>
    <div class="modal-body clearfix">
      <ul class="horizontal">
        <%= icons %>
      </ul>
    </div>
  </div>
</div>
</script>

<script id="modal-tag-color-picker" type="text/template">
<div id="tag-edit-color-picker" class="modal-dialog">
   <div class="modal-content">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h4 class="modal-title">{{_("Pick Tag Color")}}</h4>
    </div>
    <div class="modal-body clearfix">
      <ul class="horizontal">
        <%= colors %>
      </ul>
    </div>
  </div>
</div>
</script>
